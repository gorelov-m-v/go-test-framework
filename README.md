## –ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é –º—ã —Ä–µ—à–∞–µ–º

**Go —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±—ç–∫–µ–Ω–¥–∞.**
–ö–æ–º–∞–Ω–¥—ã –º–∞—Å—Å–æ–≤–æ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã, –Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∞—Å—Ç–æ –æ—Ç—Å—Ç–∞–µ—Ç. –í —ç—Ç–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –¥–≤–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1.  **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ä–∞–∑—Ä—ã–≤.** QA-–∏–Ω–∂–µ–Ω–µ—Ä—ã –ª–∏–±–æ –≤—ã–Ω—É–∂–¥–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "–∑–æ–æ–ø–∞—Ä–∫" —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π (Python/Java –¥–ª—è —Ç–µ—Å—Ç–æ–≤ Go-—Å–µ—Ä–≤–∏—Å–æ–≤), —Ä–∞–∑—Ä—ã–≤–∞—è —Å–≤—è–∑—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π, –ª–∏–±–æ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å –≤—ã—Å–æ–∫–∏–º –ø–æ—Ä–æ–≥–æ–º –≤—Ö–æ–¥–∞ –≤ Go.
2.  **–ö–æ—à–º–∞—Ä –ø–æ–¥–¥–µ—Ä–∂–∫–∏.** E2E —Ç–µ—Å—Ç—ã –∏–º–µ—é—Ç —Ç–µ–Ω–¥–µ–Ω—Ü–∏—é –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å—Å—è –≤ –Ω–µ—á–∏—Ç–∞–µ–º—É—é "—Å—Ç–µ–Ω—É –∫–æ–¥–∞". –°—É—Ç—å –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏—è —Ç–æ–Ω–µ—Ç –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∫–ª–∏–µ–Ω—Ç–æ–≤, –ø–∞—Ä—Å–∏–Ω–≥–µ JSON –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö –æ—à–∏–±–æ–∫. –¢–∞–∫–∏–µ —Ç–µ—Å—Ç—ã —Å–ª–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å, –±–æ–ª—å–Ω–æ —á–∏—Ç–∞—Ç—å –∏ –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å.

–≠—Ç–æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å–æ–∑–¥–∞–Ω, —á—Ç–æ–±—ã —É—Å—Ç—Ä–∞–Ω–∏—Ç—å —ç—Ç–∏ –±–∞—Ä—å–µ—Ä—ã. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ **–µ–¥–∏–Ω–æ–º —Å—Ç–µ–∫–µ**, –ø—Ä–µ–≤—Ä–∞—â–∞—è –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–¥ –≤ —á–∏—Å—Ç—ã–π –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–∞–∂–¥–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É –ø—Ä–æ—Ü–µ—Å—Å–∞.

## –ò–¥–µ–æ–ª–æ–≥–∏—è –ø—Ä–æ–µ–∫—Ç–∞

### 1. –ù–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –≤—Ö–æ–¥–∞ –∏ "–ë—ã—Å—Ç—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è" (DSL)
–†—É—á–Ω–æ–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Ç–µ–º–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–æ–ø—Ä–∞–≤–¥–∞–Ω–Ω–æ –¥–æ—Ä–æ–≥–∏–º –∏ –º–µ–¥–ª–µ–Ω–Ω—ã–º –±—É—Ç—ã–ª–æ—á–Ω—ã–º –≥–æ—Ä–ª—ã—à–∫–æ–º.
–§—Ä–µ–π–º–≤–æ—Ä–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **Fluent Interface**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ä—É—á–Ω—ã—Ö —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤. –í–º–µ—Å—Ç–æ –±–æ—Ä—å–±—ã —Å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º –∫–æ–¥–∞ (`if err != nil`), QA –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π: `Request... Expect... Fetch`.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú—ã –ø–µ—Ä–µ—Ö–æ–¥–∏–º –æ—Ç "–¥–æ–≥–æ–Ω—è—é—â–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏" –∫ –≤—ã–ø—É—Å–∫—É —Ç–µ—Å—Ç–æ–≤ **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –ø—Ä–æ–¥—É–∫—Ç–æ–º**. –≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç —Ä—É—Ç–∏–Ω—É —Ä—É—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ —Å–æ–∫—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è —Ä–µ–≥—Ä–µ—Å—Å–∞ —Å –¥–Ω–µ–π –¥–æ –º–∏–Ω—É—Ç.

### 2. –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ (–ë–æ—Ä—å–±–∞ —Å Flaky-—Ç–µ—Å—Ç–∞–º–∏)
–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã. –î–∞–Ω–Ω—ã–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –ë–î –∏–ª–∏ –ë—Ä–æ–∫–µ—Ä–µ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ API.
–ú–µ—Ö–∞–Ω–∏–∑–º "—É–º–Ω—ã—Ö —Ä–µ—Ç—Ä–∞–µ–≤" (Polling —Å Backoff & Jitter) –≤—Å—Ç—Ä–æ–µ–Ω –≥–ª—É–±–æ–∫–æ –≤ —è–¥—Ä–æ DSL.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—ã –ø–∏—à–µ—Ç–µ –ª–∏–Ω–µ–π–Ω—ã–π —Ç–µ—Å—Ç, –∞ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å–∞–º –±–µ—Ä–µ—Ç –Ω–∞ —Å–µ–±—è –æ–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö. –ù–∏–∫–∞–∫–∏—Ö `time.Sleep()` –∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö (–º–∏–≥–∞—é—â–∏—Ö) —Ç–µ—Å—Ç–æ–≤.

### 3. Dependency Injection –≤ —Å—Ç–∏–ª–µ Spring
–í –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ –≤ —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è –¥–µ—Å—è—Ç–∫–æ–≤ —Å—Ç—Ä–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ—á–Ω–æ–≥–æ –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å—Ç–æ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –∏ –ª–æ–º–∞–µ—Ç—Å—è.
–ó–¥–µ—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º **"–£–º–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"** (Tag-based DI): –≤—ã –¥–æ–±–∞–≤–ª—è–µ—Ç–µ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å–∞–º –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –Ω—É–∂–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∑–∞–Ω–∏–º–∞–µ—Ç **30 —Å–µ–∫—É–Ω–¥**. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –æ—Å—Ç–∞–µ—Ç—Å—è —á–∏—Å—Ç–æ–π, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ –≤—ã—Ä–∞—Å—Ç–∞–µ—Ç –¥–æ —Ç—ã—Å—è—á.

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å (Allure)
–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã, –Ω–æ –∏—Ö —Ä—É—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ - —ç—Ç–æ —Ä—É—Ç–∏–Ω–∞.
–ó–¥–µ—Å—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å **Allure Report** "–∑–∞—à–∏—Ç–∞" –≤ —è–¥—Ä–æ DSL. –õ—é–±–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (HTTP –∑–∞–ø—Ä–æ—Å, SQL –≤—ã–±–æ—Ä–∫–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –∏–∑ Kafka) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–∞–≥ –æ—Ç—á–µ—Ç–∞.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** QA —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∞. –í—Å—è "–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–∞—è –±–∞–∑–∞" (Request/Response, Headers, SQL) —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è "–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º".

### 5. –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å
E2E —Ç–µ—Å—Ç—ã —á–∞—Å—Ç–æ –±—ã–≤–∞—é—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏ –∏–∑-–∑–∞ IO-–æ–ø–µ—Ä–∞—Ü–∏–π. –§—Ä–µ–π–º–≤–æ—Ä–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Go (Goroutines) –Ω–∞ –ø–æ–ª–Ω—É—é –º–æ—â–Ω–æ—Å—Ç—å.
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ä–∞–∑–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –Ω–æ –∏ **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞**.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—ã –º–æ–∂–µ—Ç–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∂–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤ Kafka, –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∑–∞–ø–∏—Å—å –≤ –ë–î –∏ –¥–µ—Ä–≥–∞—Ç—å API, –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ —Å–æ–∫—Ä–∞—â–∞—è –≤—Ä–µ–º—è –ø—Ä–æ–≥–æ–Ω–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞.

## –ù–∞–≤–∏–≥–∞—Ü–∏—è

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –≤–∞—à –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç –∑–∞ 5 –º–∏–Ω—É—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç-–≤–∞—à-–ø–µ—Ä–≤—ã–π-—Ç–µ—Å—Ç-–∑–∞-5-–º–∏–Ω—É—Ç)
- [–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [HTTP DSL](#http-dsl)
    - [–°–∫–≤–æ–∑–Ω–æ–π E2E –ø—Ä–∏–º–µ—Ä: –®–∞–≥ 1 - HTTP –∑–∞–ø—Ä–æ—Å](#—Å–∫–≤–æ–∑–Ω–æ–π-e2e-–ø—Ä–∏–º–µ—Ä-—à–∞–≥-1---http-–∑–∞–ø—Ä–æ—Å)
    - [–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π DSL](#—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π-dsl)
- [Database DSL](#database-dsl-sql)
    - [–°–∫–≤–æ–∑–Ω–æ–π E2E –ø—Ä–∏–º–µ—Ä: –®–∞–≥ 2 - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î](#—Å–∫–≤–æ–∑–Ω–æ–π-e2e-–ø—Ä–∏–º–µ—Ä-—à–∞–≥-2---–ø—Ä–æ–≤–µ—Ä–∫–∞-–≤-–±–¥)
    - [–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–µ—Ç–æ–¥–æ–≤ DB DSL](#—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫-–º–µ—Ç–æ–¥–æ–≤-db-dsl)
- [Kafka DSL](#kafka-dsl)
    - [–°–∫–≤–æ–∑–Ω–æ–π E2E –ø—Ä–∏–º–µ—Ä: –®–∞–≥ 3 - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏—è –≤ Kafka](#—Å–∫–≤–æ–∑–Ω–æ–π-e2e-–ø—Ä–∏–º–µ—Ä-—à–∞–≥-3---–ø—Ä–æ–≤–µ—Ä–∫–∞-—Å–æ–±—ã—Ç–∏—è-–≤-kafka)
    - [–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–µ—Ç–æ–¥–æ–≤ Kafka DSL](#—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫-–º–µ—Ç–æ–¥–æ–≤-kafka-dsl)
- [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —à–∞–≥–∏ (AsyncStep)](#–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ-—à–∞–≥–∏-asyncstep)
    - [–ü—Ä–æ–±–ª–µ–º–∞: Flaky-—Ç–µ—Å—Ç—ã –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö](#–ø—Ä–æ–±–ª–µ–º–∞-flaky-—Ç–µ—Å—Ç—ã-–≤-–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö-—Å–∏—Å—Ç–µ–º–∞—Ö)
    - [–†–µ—à–µ–Ω–∏–µ: AsyncStep —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ retry](#—Ä–µ—à–µ–Ω–∏–µ-asyncstep-—Å-–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏-retry)
    - [–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ](#–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
    - [–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Step –∏ AsyncStep](#—Ä–∞–∑–Ω–∏—Ü–∞-–º–µ–∂–¥—É-step-–∏-asyncstep)
    - [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-1)
    - [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
    - [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
- [–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö](#–º–∞—Å–∫–∏—Ä–æ–≤–∫–∞-—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö-–¥–∞–Ω–Ω—ã—Ö)
    - [–ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞](#–∑–∞—á–µ–º-–Ω—É–∂–Ω–∞-–º–∞—Å–∫–∏—Ä–æ–≤–∫–∞)
    - [–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã](#–ø—Ä–∏–Ω—Ü–∏–ø-—Ä–∞–±–æ—Ç—ã)
    - [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–º–∞—Å–∫–∏—Ä–æ–≤–∫–∏)
    - [–ü—Ä–∏–º–µ—Ä—ã –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏](#–ø—Ä–∏–º–µ—Ä—ã-–º–∞—Å–∫–∏—Ä–æ–≤–∫–∏)
    - [–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è](#–≤–∞–∂–Ω—ã–µ-–∑–∞–º–µ—á–∞–Ω–∏—è)
    - [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-1)

---

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –≤–∞—à –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç –∑–∞ 5 –º–∏–Ω—É—Ç

–õ—É—á—à–∏–π —Å–ø–æ—Å–æ–± –æ—Å–≤–æ–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç - —ç—Ç–æ —É–≤–∏–¥–µ—Ç—å –µ–≥–æ –≤ –¥–µ–π—Å—Ç–≤–∏–∏. –ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ —à–∞–±–ª–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –ø—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –≥–æ—Ç–æ–≤—ã–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã.
–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø –Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Å—Ä–∞–∑—É –ø–µ—Ä–µ–π—Ç–∏ –∫ –Ω–∞–ø–∏—Å–∞–Ω–∏—é —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

#### –®–∞–≥ 1: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

*   **Go** (–≤–µ—Ä—Å–∏—è 1.25 –∏–ª–∏ –≤—ã—à–µ)
*   **Git**
*   **Allure Commandline** (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤). [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ](https://docs.qameta.io/allure/#_installing_a_commandline).

#### –®–∞–≥ 2: –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç

–í–∞–º –Ω–µ –Ω—É–∂–Ω–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–∞–º–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç-—à–∞–±–ª–æ–Ω, –≥–¥–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.

```bash
# –ó–ê–ì–õ–£–®–ö–ê: –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
git clone https://github.com/your-org/go-e2e-framework-example.git my-api-tests

cd my-api-tests
```

#### –®–∞–≥ 3: –ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–í –ø—Ä–æ–µ–∫—Ç–µ —É–∂–µ –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–π —Ñ–∞–π–ª `configs/config.local.yaml`. –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ–∫—Ü–∏–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∑–Ω–∞—á–µ–Ω–∏–π.

–û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ –≤–∞—à–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∏ –∑–∞–º–µ–Ω–∏—Ç–µ placeholder-–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `baseURL` –¥–ª—è –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏ `dsn` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö).

#### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã

–¢–µ–ø–µ—Ä—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:

```bash
go test -v ./...
```

–£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –≤—ã–≤–æ–¥–æ–º `--- PASS` –≤ –∫–æ–Ω—Å–æ–ª–∏. –≠—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –∞ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `allure-results` —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –ø—Ä–æ–≥–æ–Ω–∞.

#### –®–∞–≥ 5: –ò–∑—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç

–ù–∞ —ç—Ç–æ–º —à–∞–≥–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ, –∫–∞–∫ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–≥–æ–Ω–∞. –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–∞ Allure –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
allure serve allure-results
```

–í –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –æ—Ç—á–µ—Ç–æ–º. –ò–∑—É—á–∏—Ç–µ —à–∞–≥–∏ —Ç–µ—Å—Ç–∞, —Ä–∞—Å–∫—Ä–æ–π—Ç–µ –≤–ª–æ–∂–µ–Ω–∏—è —Å HTTP-–∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å—è "–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–∞—è –±–∞–∑–∞" —Å–æ–±—Ä–∞–Ω–∞ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–∏–ª–∏–π —Å –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω—ã.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å—Ç–∏–ª–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π E2E-—Ç–µ—Å—Ç.

–¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã –∫ —Ä–µ—à–µ–Ω–∏—é —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á:
1.  **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ** –∫–æ–¥ –≤ —Ñ–∞–π–ª–∞—Ö `*_test.go`, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –ª–æ–≥–∏–∫—É –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤.
2.  **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—è —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ –º–æ–¥–µ–ª–∏ –≤–∞—à–µ–≥–æ API.
3.  **–°–æ–∑–¥–∞–π—Ç–µ** –Ω–æ–≤—ã–π —Ç–µ—Å—Ç, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –≥–æ—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–∞–∫ –Ω–∞ –æ–±—Ä–∞–∑–µ—Ü.

–î–∞–ª—å–Ω–µ–π—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–ª—É–∂–∏—Ç —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º –ø–æ –≤—Å–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º DSL, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–¥–µ–∂–Ω—ã—Ö –∏ —á–∏—Ç–∞–µ–º—ã—Ö E2E-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

---

# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–§—Ä–µ–π–º–≤–æ—Ä–∫ –Ω–µ –Ω–∞–≤—è–∑—ã–≤–∞–µ—Ç –∂–µ—Å—Ç–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –Ω–æ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤:

```
your-api-tests/
‚îú‚îÄ‚îÄ configs/                      # –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ config.local.yaml         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ internal/                     # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ client/                   # HTTP –∫–ª–∏–µ–Ω—Ç—ã (DSL –º–µ—Ç–æ–¥—ã)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [service_name]/       # –û—Ç–¥–µ–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ client.go         # DSL –º–µ—Ç–æ–¥—ã –¥–ª—è API —Å–µ—Ä–≤–∏—Å–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ db/                       # Database —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [table_name]/         # –û—Ç–¥–µ–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã/–¥–æ–º–µ–Ω–∞
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ repo.go           # DSL –º–µ—Ç–æ–¥—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/                   # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ http/                 # HTTP –º–æ–¥–µ–ª–∏ (–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [service_name]/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ *.go          # Request/Response –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db/                   # Database –º–æ–¥–µ–ª–∏ (–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –ø–æ –ë–î)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ [database_name]/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ *.go          # –ú–æ–¥–µ–ª–∏ —Ç–∞–±–ª–∏—Ü —Å —Ç–µ–≥–∞–º–∏ `db`
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ kafka/                    # Kafka —Ç–æ–ø–∏–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ topics.go             # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ–ø–∏–∫–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ
‚îú‚îÄ‚îÄ tests/                        # –¢–µ—Å—Ç–æ–≤—ã–µ —Å—å—é—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ env.go                    # –¢–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
‚îÇ   ‚îî‚îÄ‚îÄ *_test.go                 # –§–∞–π–ª—ã —Å —Ç–µ—Å—Ç–∞–º–∏
‚îÇ
‚îú‚îÄ‚îÄ allure-results/               # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã Allure (–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ go.mod
‚îî‚îÄ‚îÄ go.sum
```

## –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ª–æ—è–º
- **`internal/client/`** ‚Äî HTTP DSL –º–µ—Ç–æ–¥—ã, –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º
- **`internal/db/`** ‚Äî Database DSL –º–µ—Ç–æ–¥—ã, –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º/–¥–æ–º–µ–Ω–∞–º
- **`internal/models/`** ‚Äî –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ `http/` –∏ `db/`
- **`internal/kafka/`** ‚Äî Kafka —Ç–æ–ø–∏–∫–∏ –∏ –º–æ–¥–µ–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### 2. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–æ–º–µ–Ω–∞–º
–ö–∞–∂–¥—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å/—Ç–∞–±–ª–∏—Ü–∞/—Ç–æ–ø–∏–∫ –∏–º–µ–µ—Ç —Å–≤–æ—é –ø–∞–ø–∫—É:
```
internal/client/
‚îú‚îÄ‚îÄ game/client.go      # DSL –¥–ª—è Game API
‚îú‚îÄ‚îÄ auth/client.go      # DSL –¥–ª—è Auth API
‚îî‚îÄ‚îÄ payment/client.go   # DSL –¥–ª—è Payment API
```

### 3. –ú–æ–¥–µ–ª–∏ —Ä—è–¥–æ–º —Å –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
```
internal/models/
‚îú‚îÄ‚îÄ http/
‚îÇ   ‚îú‚îÄ‚îÄ game/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ player.go         # CreatePlayerReq, CreatePlayerResp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ game_session.go   # StartSessionReq, StartSessionResp
‚îÇ   ‚îî‚îÄ‚îÄ auth/
‚îÇ       ‚îî‚îÄ‚îÄ token.go          # TokenRequest, TokenResponse
‚îî‚îÄ‚îÄ db/
    ‚îî‚îÄ‚îÄ core/
        ‚îú‚îÄ‚îÄ player.go         # PlayerDB (—Å —Ç–µ–≥–∞–º–∏ `db`)
        ‚îî‚îÄ‚îÄ game_category.go  # GameCategoryDB
```

### 4. –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
`tests/env.go` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```go
type TestEnv struct {
    // HTTP –∫–ª–∏–µ–Ω—Ç—ã
    GameService    game.Link    `config:"gameService"`
    AuthService    auth.Link    `config:"authService"`

    // Database —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
    PlayersRepo    players.Link `db_config:"coreDatabase"`

    // Kafka
    Kafka          kafka.Link   `kafka_config:"kafka"`
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å:** –õ—é–±–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∑–Ω–∞–µ—Ç, –≥–¥–µ –∏—Å–∫–∞—Ç—å DSL –º–µ—Ç–æ–¥ –∏–ª–∏ –º–æ–¥–µ–ª—å
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã/—Ç–∞–±–ª–∏—Ü—ã –±–µ–∑ —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏
- **–ò–∑–æ–ª—è—Ü–∏—è:** –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
- **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** DSL –º–µ—Ç–æ–¥—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö

---

# HTTP DSL

–ú–æ–¥—É–ª—å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ REST API.
–û–Ω –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **Generics**, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –í—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–≤–µ—Ä–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–ª–∏ –æ—à–∏–±–∏—Ç—å—Å—è –≤ —Ç–∏–ø–µ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.

## –°–∫–≤–æ–∑–Ω–æ–π E2E –ø—Ä–∏–º–µ—Ä: –®–∞–≥ 1 - HTTP –∑–∞–ø—Ä–æ—Å

–ù–∞—á–Ω—ë–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π E2E —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–π–¥—ë—Ç —á–µ—Ä–µ–∑ –≤—Å–µ —Ç—Ä–∏ DSL.
**–°—Ü–µ–Ω–∞—Ä–∏–π:** –°–æ–∑–¥–∞—ë–º –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ API, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–∏—Å—å –≤ –ë–î, –∂–¥—ë–º —Å–æ–±—ã—Ç–∏–µ –≤ Kafka.

### 0. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`config.local.yaml`)

```yaml
http:
  gameService:
    baseURL: "https://game-api.example.com"
    timeout: 30s
```

### 1. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è (–ö–æ–Ω—Ç—Ä–∞–∫—Ç)

```bash
curl -X POST https://game-api.example.com/api/v1/players \
  -H "Content-Type: application/json" \
  -d '{
    "username": "pro_gamer_2024",
    "region": "EU"
  }'

# Response: 201 Created
{
  "id": "uuid-12345",
  "username": "pro_gamer_2024",
  "status": "active"
}
```

### 2. –û–ø–∏—Å–∞–Ω–∏–µ –ú–æ–¥–µ–ª–µ–π
–ü–µ—Ä–µ–Ω–æ—Å–∏–º JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ Go (`internal/models/player.go`). –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ `json` —Ç–µ–≥–∏.

```go
package models

type CreatePlayerReq struct {
    Username string `json:"username"`
    Region   string `json:"region"`
}

type CreatePlayerResp struct {
    ID        string `json:"id"`
    Username  string `json:"username"`
    Status    string `json:"status"`
}
```

### 3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ö–ª–∏–µ–Ω—Ç–∞
**–§–∞–π–ª:** `internal/client/game/client.go`

```go
package game

import (
    "go-test-framework/pkg/http/client"
    "go-test-framework/pkg/http/dsl"
    "github.com/ozontech/allure-go/pkg/framework/provider"
    "my-project/internal/models"
)

// 1. –ü—Ä–∏–≤–∞—Ç–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–∫–µ—Ç–∞ (—Ö—Ä–∞–Ω–∏—Ç http.Client —Å –±–∞–∑–æ–≤—ã–º URL –∏ —Ö–µ–¥–µ—Ä–∞–º–∏)
var httpClient *client.Client

// 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Link –¥–ª—è Auto-Wiring.
// –ë–∏–ª–¥–µ—Ä –Ω–∞–π–¥–µ—Ç –µ—ë –≤ TestEnv –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω–µ–¥—Ä–∏—Ç –∫–ª–∏–µ–Ω—Ç.
type Link struct{}

func (l *Link) SetHTTP(c *client.Client) {
    httpClient = c
}

// 3. DSL –ú–µ—Ç–æ–¥
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Call: [RequestModel, ResponseModel]
func CreatePlayer(sCtx provider.StepCtx) *dsl.Call[models.CreatePlayerReq, models.CreatePlayerResp] {
    // dsl.NewCall —Å–≤—è–∑—ã–≤–∞–µ—Ç —à–∞–≥ —Ç–µ—Å—Ç–∞ (sCtx) –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç (httpClient).
    // –î–∞–ª–µ–µ –º—ã —Å—Ä–∞–∑—É —É–∫–∞–∑—ã–≤–∞–µ–º HTTP –º–µ—Ç–æ–¥ –∏ –ø—É—Ç—å.
    return dsl.NewCall[models.CreatePlayerReq, models.CreatePlayerResp](sCtx, httpClient).
        POST("/api/v1/players")
}
```

### 4. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ Env
–î–æ–±–∞–≤–ª—è–µ–º —Å–≤—è–∑—å –≤ `tests/env.go`. –ë–∏–ª–¥–µ—Ä —É–≤–∏–¥–∏—Ç `game.Link` –∏ –ø—Ä–æ–∫–∏–Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

**–§–∞–π–ª:** `tests/env.go`

```go
package tests

import (
    "go-test-framework/pkg/builder"
    "log"
    "my-project/internal/client/game"
)

type TestEnv struct {
    // HTTP –∫–ª–∏–µ–Ω—Ç—ã - —Å–≤—è–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥ "gameService" —Å –ø–∞–∫–µ—Ç–æ–º "game"
    GameService game.Link `config:"gameService"`
}

var env *TestEnv

func init() {
    env = &TestEnv{}

    if err := builder.BuildEnv(env); err != nil {
        log.Fatalf("Failed to build test environment: %v", err)
    }
}

func Env() *TestEnv {
    return env
}
```

### 5. –¢–µ—Å—Ç: –°–æ–∑–¥–∞—ë–º –∏–≥—Ä–æ–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º ID
–≠—Ç–æ –Ω–∞—á–∞–ª–æ –Ω–∞—à–µ–≥–æ —Å–∫–≤–æ–∑–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è. –ú—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º HTTP-–∑–∞–ø—Ä–æ—Å –∏ **—Å–æ—Ö—Ä–∞–Ω—è–µ–º `playerID`** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö (Database –∏ Kafka).

```go
func (s *PlayerSuite) TestCreatePlayerE2E(t provider.T) {
    t.Title("E2E: –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ (HTTP ‚Üí DB ‚Üí Kafka)")

    var playerID string
    var username = "pro_gamer_2024"

    // –®–ê–ì 1: HTTP - –°–æ–∑–¥–∞—ë–º –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ API
    s.Step(t, "HTTP: –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ API", func(sCtx provider.StepCtx) {
        resp := game.CreatePlayer(sCtx).
            // 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (—Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è)
            RequestBody(models.CreatePlayerReq{
                Username: username,
                Region:   "EU",
            }).
            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞
            ExpectResponseStatus(201).
            ExpectResponseBodyFieldNotEmpty("id").
            ExpectResponseBodyFieldValue("username", username).
            ExpectResponseBodyFieldValue("status", "active").
            // 3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
            Send()

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –ë–î –∏ Kafka
        playerID = resp.Body.ID
    })

    // –®–ê–ì 2: Database - —Å–º. —Ä–∞–∑–¥–µ–ª "Database DSL" –Ω–∏–∂–µ
    // –®–ê–ì 3: Kafka - —Å–º. —Ä–∞–∑–¥–µ–ª "Kafka DSL" –Ω–∏–∂–µ
}
```

---

## –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π DSL

–û–±—ä–µ–∫—Ç `dsl.Call[TReq, TResp]` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–æ–≥–∞—Ç—ã–π –Ω–∞–±–æ—Ä –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞.

### üîß 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (Request Configuration)

–≠—Ç–∏ –º–µ—Ç–æ–¥—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, *—á—Ç–æ* –º—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º.

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
| :--- | :--- | :--- |
| `.Header(k, v)` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞. | `.Header("Authorization", "Bearer ...")` |
| `.QueryParam(k, v)` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ GET-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞. | `.QueryParam("page", "1")` -> `?page=1` |
| `.PathParam(k, v)` | –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ –ø—É—Ç—å. | `.PathParam("id", "123")` -> `/users/123` |
| `.RequestBody(val)` | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–ª–∞ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞). | `.RequestBody(models.User{...})` |

### 2. –û–∂–∏–¥–∞–Ω–∏—è (Expectations)

–ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Ü–µ–ø–æ—á–∫—É **–¥–æ** –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞. –û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É "Silent Success, Loud Failure": –µ—Å–ª–∏ –≤—Å—ë —Ö–æ—Ä–æ—à–æ, —Ç–µ—Å—Ç –∏–¥–µ—Ç –¥–∞–ª—å—à–µ. –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ—à–ª–∞, —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤ Allure.

#### –°—Ç–∞—Ç—É—Å –∏ –¢–µ–ª–æ
*   `.ExpectResponseStatus(code int)` ‚Äî –ü—Ä–æ–≤–µ—Ä—è–µ—Ç HTTP Status Code.
*   `.ExpectResponseBodyNotEmpty()` ‚Äî –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–µ–ª–æ –æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏—à–ª–æ –∏ –Ω–µ –ø—É—Å—Ç–æ–µ.

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–µ–π (JSON Path)
–î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å [GJSON](https://github.com/tidwall/gjson).

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, API –≤–µ—Ä–Ω—É–ª —Ç–∞–∫–æ–π –æ—Ç–≤–µ—Ç:
```json
{
  "token": "eyJhbGciOiJIUz...",
  "meta": { "server": "auth-01" },
  "items": [
    { "id": 101, "code": "read" },
    { "id": 102, "code": "write" }
  ]
}
```

**–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–≤–µ—Ä–æ–∫:**

| –ü—É—Ç—å (Path) | –ó–Ω–∞—á–µ–Ω–∏–µ | DSL –ú–µ—Ç–æ–¥ |
| :--- | :--- | :--- |
| `"token"` | `"eyJ..."` | `.ExpectResponseBodyFieldNotEmpty("token")` |
| `"meta.server"` | `"auth-01"` | `.ExpectResponseBodyFieldValue("meta.server", "auth-01")` |
| `"items.0.code"` | `"read"` | `.ExpectResponseBodyFieldValue("items.0.code", "read")` |
| `"items.#"` | `2` | `.ExpectResponseBodyFieldValue("items.#", 2)` |

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—É—Ç–µ–π:**
- –ü—Ä–æ—Å—Ç—ã–µ –ø–æ–ª—è: `"name"`
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—è: `"user.email"`
- –≠–ª–µ–º–µ–Ω—Ç—ã –º–∞—Å—Å–∏–≤–∞: `"items.0"`, `"items.1"`
- –ü–æ–¥—Å—á—ë—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤: `"items.#"`
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—è –≤ –º–∞—Å—Å–∏–≤–µ: `"users.0.name"`

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:**
*   `string`: `"active"`
*   `int`, `float`: `100`, `99.99`
*   `bool`: `true`, `false`
*   `nil`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–æ–ª–µ –≤ JSON —Ä–∞–≤–Ω–æ `null` –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

### 3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –†–µ–∑—É–ª—å—Ç–∞—Ç

*   `.Send()` ‚Äî **–§–∏–Ω–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π –º–µ—Ç–æ–¥.**
    1.  –°–æ–±–∏—Ä–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å.
    2.  –°–æ–∑–¥–∞–µ—Ç —à–∞–≥ –≤ Allure.
    3.  –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç `curl`, Headers, Body –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞.
    4.  –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ `Expect` –ø—Ä–æ–≤–µ—Ä–∫–∏.
    5.  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç `*client.Response[TResp]`.

    ```go
    // –ü—Ä–∏–º–µ—Ä chain-requests: –°–æ–∑–¥–∞–ª–∏ -> –ó–∞–±—Ä–∞–ª–∏ ID
    var playerID string

    s.Step(t, "Create", func(sCtx provider.StepCtx) {
        resp := game.CreatePlayer(sCtx).
            RequestBody(...).
            ExpectResponseStatus(201).
            Send() // <-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç *Response[CreatePlayerResp]

        playerID = resp.Body.ID // –°—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
    })
    ```

---

# Database DSL (SQL)

–ú–æ–¥—É–ª—å `pkg/database/dsl` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è **–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–π.
–û–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç PostgreSQL –∏ MySQL.

---

## –°–∫–≤–æ–∑–Ω–æ–π E2E –ø—Ä–∏–º–µ—Ä: –®–∞–≥ 2 - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ API –ø—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –∑–∞–ø–∏—Å—å –ø–æ–ø–∞–ª–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

### 0. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`config.local.yaml`)

–†–∞—Å—à–∏—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º —Å–µ–∫—Ü–∏—é `database`:

```yaml
http:
  gameService:
    baseURL: "https://game-api.example.com"
    timeout: 30s

database:
  coreDatabase:
    driver: "postgres"  # –∏–ª–∏ "mysql"
    dsn: "postgres://user:password@localhost:5432/game_db?sslmode=disable"
    maxOpenConns: 10
    maxIdleConns: 5
```

**–û–∂–∏–¥–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `players`:**

| id | username | status | region | is_vip | created_at |
|:---|:---------|:-------|:-------|:-------|:-----------|
| uuid-12345 | pro_gamer_2024 | active | EU | false | 2024-01-09 10:30:00 |

### 1. –û–ø–∏—Å–∞–Ω–∏–µ –ú–æ–¥–µ–ª–∏ –ë–î
–û–ø–∏—à–∏—Ç–µ Go-—Å—Ç—Ä—É–∫—Ç—É—Ä—É, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–≥ `db` –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –∫–æ–ª–æ–Ω–æ–∫.

**–§–∞–π–ª:** `internal/models/db_player.go`

```go
package models

import (
    "database/sql"
    "time"
)

type PlayerDB struct {
    ID        string         `db:"id"`
    Username  string         `db:"username"`
    Status    string         `db:"status"`
    Region    sql.NullString `db:"region"`
    IsVip     bool           `db:"is_vip"`
    CreatedAt time.Time      `db:"created_at"`
}
```

### 2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (Auto-Wiring)
**–§–∞–π–ª:** `internal/db/players/repo.go`

```go
package players

import (
    "go-test-framework/pkg/database/client"
    "go-test-framework/pkg/database/dsl"
    "github.com/ozontech/allure-go/pkg/framework/provider"
    "my-project/internal/models"
)

var dbClient *client.Client

// Link –¥–ª—è Auto-Wiring
type Link struct{}

func (l *Link) SetDB(c *client.Client) {
    dbClient = c
}

// DSL –ú–µ—Ç–æ–¥: –ü–æ–∏—Å–∫ –ø–æ ID
func FindByID(sCtx provider.StepCtx, id string) *dsl.Query[models.PlayerDB] {
    return dsl.NewQuery[models.PlayerDB](sCtx, dbClient).
        SQL("SELECT * FROM players WHERE id = ?", id)
}
```

### 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ Env
–†–∞—Å—à–∏—Ä—è–µ–º `tests/env.go` ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º Database –∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É HTTP –∫–ª–∏–µ–Ω—Ç—É.

**–§–∞–π–ª:** `tests/env.go`

```go
package tests

import (
    "go-test-framework/pkg/builder"
    "log"
    "my-project/internal/client/game"
    "my-project/internal/db/players"
)

type TestEnv struct {
    // HTTP –∫–ª–∏–µ–Ω—Ç—ã
    GameService game.Link `config:"gameService"`

    // Database - —Å–≤—è–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥ "coreDatabase" —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º "players"
    PlayersRepo players.Link `db_config:"coreDatabase"`
}

var env *TestEnv

func init() {
    env = &TestEnv{}

    if err := builder.BuildEnv(env); err != nil {
        log.Fatalf("Failed to build test environment: %v", err)
    }
}

func Env() *TestEnv {
    return env
}
```

### 4. –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ë–î
–î–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–π —à–∞–≥ –∫ –Ω–∞—à–µ–º—É E2E-—Ç–µ—Å—Ç—É. –ò—Å–ø–æ–ª—å–∑—É–µ–º `playerID`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∏–ª–∏ –∏–∑ HTTP-–æ—Ç–≤–µ—Ç–∞.

```go
func (s *PlayerSuite) TestCreatePlayerE2E(t provider.T) {
    t.Title("E2E: –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ (HTTP ‚Üí DB ‚Üí Kafka)")

    var playerID string
    var username = "pro_gamer_2024"

    // –®–ê–ì 1: HTTP - –°–æ–∑–¥–∞—ë–º –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ API
    s.Step(t, "HTTP: –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ API", func(sCtx provider.StepCtx) {
        resp := game.CreatePlayer(sCtx).
            // 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (—Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è)
            RequestBody(models.CreatePlayerReq{
                Username: username,
                Region:   "EU",
            }).
            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞
            ExpectResponseStatus(201).
            ExpectResponseBodyFieldNotEmpty("id").
            ExpectResponseBodyFieldValue("username", username).
            ExpectResponseBodyFieldValue("status", "active").
            // 3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
            Send()

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –ë–î –∏ Kafka
        playerID = resp.Body.ID
    })

    // –®–ê–ì 2: Database - –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–∏—Å—å –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω–æ–º—É ID
    s.Step(t, "Database: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –ë–î", func(sCtx provider.StepCtx) {
        players.FindByID(sCtx, playerID). // –ò—Å–ø–æ–ª—å–∑—É–µ–º ID –∏–∑ HTTP-—à–∞–≥–∞

            // –û–∂–∏–¥–∞–µ–º, —á—Ç–æ –∑–∞–ø–∏—Å—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            ExpectFound().

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫
            ExpectColumnEquals("username", username).
            ExpectColumnEquals("status", "active").
            ExpectColumnEquals("region", "EU").
            ExpectColumnFalse("is_vip").         // –ü—Ä–æ–≤–µ—Ä–∫–∞ bool
            ExpectColumnIsNotNull("created_at"). // –î–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∞

            // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (SELECT –∏ —Å–∫–∞–Ω –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É)
            Send()
    })

    // –®–ê–ì 3: Kafka - —Å–º. —Ä–∞–∑–¥–µ–ª "Kafka DSL" –Ω–∏–∂–µ
}
```

---

## –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–µ—Ç–æ–¥–æ–≤ DB DSL

–û–±—ä–µ–∫—Ç `dsl.Query[Model]` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î.

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
*   `.SQL(query, args...)` ‚Äî –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å –∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ã.
    *   –î–ª—è MySQL –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `?`: `WHERE id = ?`
    *   –î–ª—è PostgreSQL (pgx/sqlx) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `$`: `WHERE id = $1`

### 2. –û–∂–∏–¥–∞–Ω–∏—è (Expectations)
–ü—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–ø–æ—Å–ª–µ** –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –ë–î.

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è:**
*   `.ExpectFound()` ‚Äî –û–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω–µ—Ç —Ö–æ—Ç—è –±—ã 1 —Å—Ç—Ä–æ–∫—É.
*   `.ExpectNotFound()` ‚Äî –û–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω–µ—Ç `sql.ErrNoRows`.

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π –∫–æ–ª–æ–Ω–æ–∫:**
*   `.ExpectColumnEquals("col", val)` ‚Äî –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.
*   `.ExpectColumnTrue("col")` / `.ExpectColumnFalse("col")` ‚Äî –î–ª—è boolean –ø–æ–ª–µ–π.
*   `.ExpectColumnIsNull("col")` / `.ExpectColumnIsNotNull("col")` ‚Äî –î–ª—è `sql.Null*` —Ç–∏–ø–æ–≤.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ (`"col"`) –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ç–µ–≥–æ–º `db` –≤ –≤–∞—à–µ–π –º–æ–¥–µ–ª–∏.

### 3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

*   `.Send()` ‚Äî **–§–∏–Ω–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π –º–µ—Ç–æ–¥.**
    1.  –í—ã–ø–æ–ª–Ω—è–µ—Ç SQL –∑–∞–ø—Ä–æ—Å (`GetContext`).
    2.  –°–∫–∞–Ω–∏—Ä—É–µ—Ç –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `Model`.
    3.  –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.
    4.  –°–æ–∑–¥–∞–µ—Ç —à–∞–≥ –≤ Allure —Å Query –∏ Result.
    5.  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É `Model`.

---

# Kafka DSL

–ú–æ–¥—É–ª—å `pkg/kafka/dsl` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è **–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π** –≤ Apache Kafka.
–û–Ω –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Ñ–æ–Ω–æ–≤–æ–º consumer'–µ, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ —á–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±—É—Ñ–µ—Ä, –ø–æ–∑–≤–æ–ª—è—è —Ç–µ—Å—Ç–∞–º –∏—Å–∫–∞—Ç—å —Å–æ–±—ã—Ç–∏—è —Å retry-–ª–æ–≥–∏–∫–æ–π.

---

## –°–∫–≤–æ–∑–Ω–æ–π E2E –ø—Ä–∏–º–µ—Ä: –®–∞–≥ 3 - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏—è –≤ Kafka

–§–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥: –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∏–ª–∞ —Å–æ–±—ã—Ç–∏–µ `PLAYER_CREATED` –≤ Kafka.

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`config.local.yaml`)

–î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–µ–∫—Ü–∏—é ‚Äî `kafka`:

```yaml
http:
  gameService:
    baseURL: "https://game-api.example.com"
    timeout: 30s

database:
  coreDatabase:
    driver: "postgres"
    dsn: "postgres://user:password@localhost:5432/game_db?sslmode=disable"
    maxOpenConns: 10
    maxIdleConns: 5

kafka:
  bootstrapServers:
    - "kafka.example.com:9092"
  groupId: "qa-test-group"
  topics:
    - "game-player-events"
  bufferSize: 1000
  uniqueDuplicateWindowMs: 5000
```

### 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–æ–ø–∏–∫–∏ –∏ –º–æ–¥–µ–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

**–§–∞–π–ª:** `internal/kafka/topics.go`

```go
package kafka

import (
    kafkaClient "go-test-framework/pkg/kafka/client"
    "go-test-framework/pkg/kafka/dsl"
)

// –ü—Ä–∏–≤–∞—Ç–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
var client *kafkaClient.Client

// Link –¥–ª—è Auto-Wiring (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ HTTP –∏ DB)
type Link struct{}

func (l *Link) SetKafka(c *kafkaClient.Client) {
    client = c

    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Å–≤—è–∑—å —Ç–æ–ø–∏–∫–∞ —Å –º–æ–¥–µ–ª—å—é
    dsl.Register[PlayerEventMessage](c, "player-events")
}

func Client() *kafkaClient.Client {
    return client
}

// –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–∏–ø —Ç–æ–ø–∏–∫–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ generic –ø–∞—Ä–∞–º–µ—Ç—Ä)
type PlayerEventsTopic string

const PlayerEventsTopicName PlayerEventsTopic = "game-player-events"

// TopicName —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å topic.TopicName
func (PlayerEventsTopic) TopicName() string {
    return string(PlayerEventsTopicName)
}

// –ú–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è
type PlayerEventMessage struct {
    PlayerID   string `json:"playerId"`
    EventType  string `json:"eventType"`
    PlayerName string `json:"playerName"`
}
```

### 3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –≤ `test_env.go`

```go
package tests

import (
    "my-project/internal/kafka"
    "my-project/internal/client/game"
    "my-project/internal/db/players"
    "go-test-framework/pkg/builder"
    "log"
)

type TestEnv struct {
    // HTTP –∫–ª–∏–µ–Ω—Ç—ã
    GameService game.Link `config:"gameService"`

    // Database
    PlayersRepo players.Link `db_config:"coreDatabase"`

    // Kafka
    Kafka kafka.Link `kafka_config:"kafka"`
}

var env *TestEnv

func init() {
    env = &TestEnv{}

    if err := builder.BuildEnv(env); err != nil {
        log.Fatalf("Failed to build environment: %v", err)
    }
}
```

---

## –ü–æ–ª–Ω—ã–π E2E —Ç–µ—Å—Ç: HTTP ‚Üí Database ‚Üí Kafka

–¢–µ–ø–µ—Ä—å —Å–æ–±–µ—Ä—ë–º –≤—Å–µ —Ç—Ä–∏ —à–∞–≥–∞ –≤–º–µ—Å—Ç–µ. –≠—Ç–æ **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π E2E —Å—Ü–µ–Ω–∞—Ä–∏–π**:

```go
import (
    "my-project/internal/kafka"
    "my-project/internal/client/game"
    "my-project/internal/db/players"
    kafkaDSL "go-test-framework/pkg/kafka/dsl"
)

func (s *PlayerSuite) TestCreatePlayerE2E(t provider.T) {
    t.Title("E2E: –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ (HTTP ‚Üí DB ‚Üí Kafka)")

    var playerID string
    var username = "pro_gamer_2024"

    // –®–ê–ì 1: HTTP - –°–æ–∑–¥–∞—ë–º –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ API
    s.Step(t, "HTTP: –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ API", func(sCtx provider.StepCtx) {
        resp := game.CreatePlayer(sCtx).
            // 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (—Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è)
            RequestBody(models.CreatePlayerReq{
                Username: username,
                Region:   "EU",
            }).
            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞
            ExpectResponseStatus(201).
            ExpectResponseBodyFieldNotEmpty("id").
            ExpectResponseBodyFieldValue("username", username).
            ExpectResponseBodyFieldValue("status", "active").
            // 3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
            Send()

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –ë–î –∏ Kafka
        playerID = resp.Body.ID
    })

    // –®–ê–ì 2: Database - –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ players
    s.Step(t, "Database: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –ë–î", func(sCtx provider.StepCtx) {
        players.FindByID(sCtx, playerID). // –ò—Å–ø–æ–ª—å–∑—É–µ–º ID –∏–∑ HTTP
            ExpectFound().
            ExpectColumnEquals("username", username).
            ExpectColumnEquals("status", "active").
            ExpectColumnEquals("region", "EU").
            ExpectColumnFalse("is_vip").
            ExpectColumnIsNotNull("created_at").
            Send()
    })

    // –®–ê–ì 3: Kafka - –ñ–¥—ë–º —Å–æ–±—ã—Ç–∏–µ PLAYER_CREATED
    s.Step(t, "Kafka: –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è PLAYER_CREATED", func(sCtx provider.StepCtx) {
        kafkaDSL.Expect[kafka.PlayerEventsTopic](sCtx, kafka.Client()).
            // –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω—É–∂–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
            With("playerId", playerID).           // –ò—Å–ø–æ–ª—å–∑—É–µ–º ID –∏–∑ HTTP
            With("eventType", "PLAYER_CREATED").  // –¢–∏–ø —Å–æ–±—ã—Ç–∏—è

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (–Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
            Unique().

            // –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª–µ–π —Å–æ–±—ã—Ç–∏—è
            ExpectField("playerName", username).  // –ò–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç
            ExpectFieldNotEmpty("timestamp").     // –î–∞—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
            ExpectFieldTrue("isActive").          // –§–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

            // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–ø–æ–∏—Å–∫)
            Send()
    })
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç E2E —Ç–µ—Å—Ç–∞:** –û–¥–∏–Ω —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∏–ª —Ç—Ä–∏ —Å–ª–æ—è —Å–∏—Å—Ç–µ–º—ã ‚Äî HTTP API, –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π.

---

## –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–µ—Ç–æ–¥–æ–≤ Kafka DSL

### –°–æ–∑–¥–∞–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:---|:---|
| `Expect[TTopic](sCtx, client)` | –°–æ–∑–¥–∞–µ—Ç –æ–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Ç–æ–ø–∏–∫–∞ |

**–ü–∞—Ä–∞–º–µ—Ç—Ä:**
- `TTopic` - —Ç–∏–ø —Ç–æ–ø–∏–∫–∞ (string-based type —Å –∏–º–µ–Ω–µ–º —Ç–æ–ø–∏–∫–∞)

### –§–∏–ª—å—Ç—Ä—ã (–¥–ª—è –ø–æ–∏—Å–∫–∞)

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:---|:---|
| `.With(key, value)` | –î–æ–±–∞–≤–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è |

**–ü—Ä–∏–º–µ—Ä—ã:**
- `.With("playerId", "123")` - –ø—Ä–æ—Å—Ç–æ–µ –ø–æ–ª–µ
- `.With("player.id", "123")` - –≤–ª–æ–∂–µ–Ω–Ω–æ–µ –ø–æ–ª–µ
- `.With("status", "ACTIVE")` - —Å—Ç—Ä–æ–∫–∞
- `.With("amount", 100)` - —á–∏—Å–ª–æ

**–õ–æ–≥–∏–∫–∞:** AND (–≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞—Å—Ç—å)

### –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:---|:---|
| `.Unique()` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ –æ–∫–Ω–µ (5 —Å–µ–∫ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞) |
| `.UniqueWithWindow(duration)` | –ö–∞—Å—Ç–æ–º–Ω–æ–µ –æ–∫–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ |

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ >1 —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ–∫–Ω–µ ‚Üí —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª–µ–π (Expectations)

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:---|:---|
| `.ExpectField(field, value)` | –ü–æ–ª–µ —Ä–∞–≤–Ω–æ –∑–Ω–∞—á–µ–Ω–∏—é |
| `.ExpectFieldNotEmpty(field)` | –ü–æ–ª–µ –Ω–µ –ø—É—Å—Ç–æ–µ |
| `.ExpectFieldIsNull(field)` | –ü–æ–ª–µ = null |
| `.ExpectFieldIsNotNull(field)` | –ü–æ–ª–µ ‚â† null |
| `.ExpectFieldTrue(field)` | –ü–æ–ª–µ = true |
| `.ExpectFieldFalse(field)` | –ü–æ–ª–µ = false |

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—É—Ç–µ–π (GJSON):**
- –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–ª–µ: `"playerName"`
- –í–ª–æ–∂–µ–Ω–Ω–æ–µ –ø–æ–ª–µ: `"player.name"`
- –≠–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞: `"items.0"`
- –ü–æ–¥—Å—á—ë—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤: `"items.#"`
- –í–ª–æ–∂–µ–Ω–Ω–æ–µ –≤ –º–∞—Å—Å–∏–≤–µ: `"users.0.email"`

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:---|:---|
| `.Send()` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–∏—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç) |

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ò—â–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º (`With`)
2. –ï—Å–ª–∏ async —Ä–µ–∂–∏–º ‚Üí retry —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ `Unique()`)
4. –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ expectations (`ExpectField*`)
5. –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Allure
6. –ü–∞–¥–∞–µ—Ç –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Å–æ—à–ª–æ—Å—å

---

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —à–∞–≥–∏ (AsyncStep)

## –ü—Ä–æ–±–ª–µ–º–∞: Flaky-—Ç–µ—Å—Ç—ã –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ: —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Kafka —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `PENDING`, –∫–æ—Ç–æ—Ä—ã–π —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `COMPLETED`. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –≤ —Ç–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ (flaky), –æ–Ω–∏ –ø–∞–¥–∞—é—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤—ã.

–¢–∏–ø–∏—á–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –±–µ–∑ AsyncStep:

```go
// –ü—Ä–æ–±–ª–µ–º–∞: —Ç–µ—Å—Ç —É–ø–∞–¥—ë—Ç, –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –≤ –ë–î –µ—â—ë –Ω–µ –ø–æ—è–≤–∏–ª–∞—Å—å
s.Step(t, "–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î", func(sCtx provider.StepCtx) {
    players.FindByID(sCtx, playerID).
        ExpectFound().  // –£–ø–∞–¥—ë—Ç —Å –æ—à–∏–±–∫–æ–π "record not found"
        Send()
})
```

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç `time.Sleep(5 * time.Second)` ‚Äî –Ω–æ —ç—Ç–æ:
- –ó–∞–º–µ–¥–ª—è–µ—Ç —Ç–µ—Å—Ç—ã (–¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã –∑–∞ 100ms)
- –ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É—Å–ø–µ—Ö (–≤ –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏)
- –°–æ–∑–¥–∞—ë—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (flaky tests)

---

## –†–µ—à–µ–Ω–∏–µ: AsyncStep —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ retry

AsyncStep **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏** –¥–æ —É—Å–ø–µ—Ö–∞ –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç–∞:

```go
// –†–µ—à–µ–Ω–∏–µ: AsyncStep –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∑–∞–ø—Ä–æ—Å, –ø–æ–∫–∞ –∑–∞–ø–∏—Å—å –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è
s.AsyncStep(t, "–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î", func(sCtx provider.StepCtx) {
    players.FindByID(sCtx, playerID).
        ExpectFound().  // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí retry —á–µ—Ä–µ–∑ interval
        ExpectColumnEquals("status", "active").
        Send()
})
```

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç `time.Sleep(5 * time.Second)`, –Ω–æ —ç—Ç–æ:
- –ó–∞–º–µ–¥–ª—è–µ—Ç —Ç–µ—Å—Ç—ã (–¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã –∑–∞ 100ms)
- –ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É—Å–ø–µ—Ö (–≤ –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏)
- –°–æ–∑–¥–∞—ë—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (flaky tests)

## –†–µ—à–µ–Ω–∏–µ: AsyncStep —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ retry

AsyncStep –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ —É—Å–ø–µ—Ö–∞ –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç–∞:

```go
// –†–µ—à–µ–Ω–∏–µ: AsyncStep –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∑–∞–ø—Ä–æ—Å, –ø–æ–∫–∞ –∑–∞–ø–∏—Å—å –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è
s.AsyncStep(t, "–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î", func(sCtx provider.StepCtx) {
    players.FindByID(sCtx, playerID).
        ExpectFound().  // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, retry —á–µ—Ä–µ–∑ interval
        ExpectColumnEquals("status", "active").
        Send()
})
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å, –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –ø—Ä–æ—à–ª–∏, –∂–¥—ë—Ç `interval` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 200ms)
2. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å, –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å—ë –µ—â—ë –Ω–µ –ø—Ä–æ—à–ª–∏, –∂–¥—ë—Ç —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º (backoff)
3. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç... –ø–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –ø—Ä–æ–π–¥—É—Ç –∏–ª–∏ –Ω–µ –∏—Å—Ç–µ—á—ë—Ç `timeout`

## –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

AsyncStep –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–≤–∞ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ retry —Å —É–º–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –æ–∂–∏–¥–∞–Ω–∏—è** (backoff & jitter)
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**

–†—è–¥–æ–º —Å—Ç–æ—è—â–∏–µ `AsyncStep` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö goroutines, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ [allure-go](https://github.com/ozontech/allure-go). –≠—Ç–æ –¥–∞–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

**–ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è:**
- 3 Kafka —Å–æ–±—ã—Ç–∏—è —Å polling 30s: **90s -> 30s** (3x –±—ã—Å—Ç—Ä–µ–µ)
- 3 HTTP-–∑–∞–ø—Ä–æ—Å–∞ –ø–æ 200ms: **600ms -> 200ms** (3x –±—ã—Å—Ç—Ä–µ–µ)
- 5 DB-–∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ 100ms: **500ms -> 100ms** (5x –±—ã—Å—Ç—Ä–µ–µ)

### –ü—Ä–∏–º–µ—Ä: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ Kafka events

** –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (—Å—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥):**
```go
// –ö–∞–∂–¥—ã–π —à–∞–≥ —Å polling 30 —Å–µ–∫—É–Ω–¥
s.Step(t, "Wait event 1", func(sCtx provider.StepCtx) {
    kafkaDSL.Expect[Topic](sCtx, client).With("id", "1").Send() // 30s
})
s.Step(t, "Wait event 2", func(sCtx provider.StepCtx) {
    kafkaDSL.Expect[Topic](sCtx, client).With("id", "2").Send() // 30s
})
s.Step(t, "Wait event 3", func(sCtx provider.StepCtx) {
    kafkaDSL.Expect[Topic](sCtx, client).With("id", "3").Send() // 30s
})
// –ò—Ç–æ–≥–æ: 90 —Å–µ–∫—É–Ω–¥
```

** –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (AsyncStep):**
```go
// –í—Å–µ —Ç—Ä–∏ —à–∞–≥–∞ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û
s.AsyncStep(t, "Wait event 1", func(sCtx provider.StepCtx) {
    kafkaDSL.Expect[Topic](sCtx, client).With("id", "1").Send() // polling 30s
})
s.AsyncStep(t, "Wait event 2", func(sCtx provider.StepCtx) {
    kafkaDSL.Expect[Topic](sCtx, client).With("id", "2").Send() // polling 30s –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!
})
s.AsyncStep(t, "Wait event 3", func(sCtx provider.StepCtx) {
    kafkaDSL.Expect[Topic](sCtx, client).With("id", "3").Send() // polling 30s –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!
})

// Sync —à–∞–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ñ–î–Å–¢ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö 3 async —à–∞–≥–æ–≤
s.Step(t, "Verify events received", func(sCtx provider.StepCtx) {
    // –í—Å–µ 3 —Å–æ–±—ã—Ç–∏—è —É–∂–µ –ø–æ–ª—É—á–µ–Ω—ã!
})
// –ò—Ç–æ–≥–æ: ~30 —Å–µ–∫—É–Ω–¥ (–≤—Ä–µ–º—è —Å–∞–º–æ–≥–æ –¥–æ–ª–≥–æ–≥–æ)
// –í—ã–∏–≥—Ä—ã—à: 3x –±—ã—Å—Ç—Ä–µ–µ
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

```go
// –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è)
s.AsyncStep(t, "Task 1", fn1) // asyncWg.Add(1) ‚Üí go func() { defer wg.Done(); fn1() }()
s.AsyncStep(t, "Task 2", fn2) // asyncWg.Add(1) ‚Üí go func() { defer wg.Done(); fn2() }()
s.AsyncStep(t, "Task 3", fn3) // asyncWg.Add(1) ‚Üí go func() { defer wg.Done(); fn3() }()

// –í—Å–µ 3 goroutines —Ä–∞–±–æ—Ç–∞—é—Ç –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û

s.Step(t, "Verify", fn4)      // asyncWg.Wait() ‚Üí –∂–¥—ë—Ç –≤—Å–µ 3 ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è fn4
```

### –†–µ–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à –ø–æ –≤—Ä–µ–º–µ–Ω–∏

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã
```
3 HTTP-–∑–∞–ø—Ä–æ—Å–∞ –ø–æ 200ms –∫–∞–∂–¥—ã–π:
  –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ: 200ms + 200ms + 200ms = 600ms
  –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:     max(200ms, 200ms, 200ms) = ~200ms
  –í—ã–∏–≥—Ä—ã—à: 3x –±—ã—Å—Ç—Ä–µ–µ
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Kafka polling —Å timeout 30s
```
3 —Å–æ–±—ã—Ç–∏—è —Å polling 30s –∫–∞–∂–¥–æ–µ:
  –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ: 30s + 30s + 30s = 90 —Å–µ–∫—É–Ω–¥
  –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:     max(30s, 30s, 30s) = ~30 —Å–µ–∫—É–Ω–¥
  –í—ã–∏–≥—Ä—ã—à: 3x –±—ã—Å—Ç—Ä–µ–µ
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–º–µ—à–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (HTTP + DB + Kafka)
```
HTTP (500ms) + DB (300ms) + Kafka (5s):
  –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ: 500ms + 300ms + 5000ms = 5.8 —Å–µ–∫—É–Ω–¥
  –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:     max(500ms, 300ms, 5000ms) = ~5 —Å–µ–∫—É–Ω–¥
  –í—ã–∏–≥—Ä—ã—à: ~15% –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –≥–ª–∞–≤–Ω–æ–µ - –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

**Sync —à–∞–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∂–¥—É—Ç –≤—Å–µ async —à–∞–≥–∏:**

```go
// Batch 1: 3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö HTTP-–∑–∞–ø—Ä–æ—Å–∞
s.AsyncStep(t, "Fetch users", ...)
s.AsyncStep(t, "Fetch products", ...)
s.AsyncStep(t, "Fetch orders", ...)

// –≠—Ç–æ—Ç sync —à–∞–≥ –¥–æ–∂–¥—ë—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö 3 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤—ã—à–µ
s.Step(t, "Verify data loaded", func(sCtx provider.StepCtx) {
    // –í—Å–µ 3 –∑–∞–ø—Ä–æ—Å–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
})

// Batch 2: 2 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö DB-–∑–∞–ø—Ä–æ—Å–∞
s.AsyncStep(t, "Query table A", ...)
s.AsyncStep(t, "Query table B", ...)

// –°–Ω–æ–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
s.Step(t, "Verify DB state", func(sCtx provider.StepCtx) {
    // –û–±–∞ DB-–∑–∞–ø—Ä–æ—Å–∞ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
})
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å `sync.WaitGroup`
- –ù–µ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å `.Wait()` —è–≤–Ω–æ
- `Step()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∂–¥—ë—Ç –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ `AsyncStep`
- `AfterEach()` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Å–µ—Ö goroutines –≤ –∫–æ–Ω—Ü–µ —Ç–µ—Å—Ç–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏

–ß—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —à–∞–≥–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∑–∞–º–µ—Ä–∞–º–∏:

```bash
# –¢–µ—Å—Ç —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –¥–ª—è –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏
go test -v -run TestParallelExecutionProof
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Step 1 started at: 14:23:10.100
Step 2 started at: 14:23:10.101  <- –í—Å–µ —Å—Ç–∞—Ä—Ç—É—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!
Step 3 started at: 14:23:10.102  <- –†–∞–∑–Ω–∏—Ü–∞ <2ms!

Total execution time: 2.01s
PROOF: Steps ran in PARALLEL (would be 6s if sequential)
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. —Ñ–∞–π–ª [`parallel_proof_test.go`](./parallel_proof_test.go) —Å –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏.

## –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Step –∏ AsyncStep

| –ê—Å–ø–µ–∫—Ç | Step | AsyncStep |
|:---|:---|:---|
| **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ | **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** –≤ goroutines |
| **–û–∂–∏–¥–∞–Ω–∏–µ** | –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É | –ñ–¥—ë—Ç –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π –≤—Å–µ async —à–∞–≥–∏ |
| **–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ** | –ü–∞–¥–∞–µ—Ç —Å—Ä–∞–∑—É (`Require`) | –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ (`Assert`) |
| **Retry** | –ù–µ—Ç | –ï—Å—Ç—å (–ø–æ –∫–æ–Ω—Ñ–∏–≥—É, –µ—Å–ª–∏ –µ—Å—Ç—å expectations) |
| **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** | API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É 4xx/5xx | –ñ–¥—ë–º —Å–æ–±—ã—Ç–∏—è Kafka, –∑–∞–ø–∏—Å—å –≤ –ë–î, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ |
| **–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ** | –¢–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ | **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º + Retry** |

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏:**
- `Step` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Require` ‚Üí –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
- `AsyncStep` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Assert` ‚Üí –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- `Step` –≤—ã–∑—ã–≤–∞–µ—Ç `asyncWg.Wait()` ‚Üí –∂–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö async —à–∞–≥–æ–≤ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- `AfterEach` –≤—ã–∑—ã–≤–∞–µ—Ç `asyncWg.Wait()` ‚Üí –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Å–µ—Ö goroutines

**–ü—Ä–∏–º–µ—Ä:**
```go
// –≠—Ç–∏ 3 —à–∞–≥–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–û
s.AsyncStep(t, "Task 1", ...) // –ó–∞–ø—É—Å—Ç–∏–ª—Å—è
s.AsyncStep(t, "Task 2", ...) // –ó–∞–ø—É—Å—Ç–∏–ª—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å Task 1
s.AsyncStep(t, "Task 3", ...) // –ó–∞–ø—É—Å—Ç–∏–ª—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å Task 1 –∏ 2

// –≠—Ç–æ—Ç —à–∞–≥ –¥–æ–∂–¥—ë—Ç—Å—è –í–°–ï–• —Ç—Ä—ë—Ö async —à–∞–≥–æ–≤
s.Step(t, "Verify", ...) // asyncWg.Wait() -> –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ async —Ä–µ–∂–∏–º–∞ –∑–∞–¥–∞—é—Ç—Å—è **–æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ DSL** –≤ `config.local.yaml`:

```yaml
# HTTP –∫–ª–∏–µ–Ω—Ç—ã
http:
  gameService:
    baseURL: "https://game-api.example.com"
    timeout: 30s

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
database:
  coreDatabase:
    driver: "postgres"
    dsn: "postgres://user:password@localhost:5432/game_db?sslmode=disable"
    maxOpenConns: 10
    maxIdleConns: 5

# Kafka
kafka:
  bootstrapServers:
    - "kafka.example.com:9092"
  groupId: "qa-test-group"
  topics:
    - "game-player-events"
  bufferSize: 1000
  uniqueDuplicateWindowMs: 5000

# HTTP DSL - –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
http_dsl:
  async:
    enabled: true          # –í–∫–ª—é—á–∏—Ç—å async —Ä–µ–∂–∏–º
    timeout: 10s           # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è
    interval: 200ms        # –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
    backoff:
      enabled: true        # –í–∫–ª—é—á–∏—Ç—å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
      factor: 1.5          # –ú–Ω–æ–∂–∏—Ç–µ–ª—å (200ms ‚Üí 300ms ‚Üí 450ms ‚Üí ...)
      max_interval: 1s     # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (–Ω–µ –±–æ–ª—å—à–µ 1 —Å–µ–∫—É–Ω–¥—ã)
    jitter: 0.2            # –°–ª—É—á–∞–π–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ ¬±20% (–ø—Ä–æ—Ç–∏–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)

# Database DSL - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ –ë–î
db_dsl:
  async:
    enabled: true
    timeout: 10s
    interval: 200ms
    backoff:
      enabled: true
      factor: 1.5
      max_interval: 1s
    jitter: 0.2

# Kafka DSL - –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
kafka_dsl:
  async:
    enabled: true
    timeout: 30s           # Kafka –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏
    interval: 200ms
    backoff:
      enabled: true
      factor: 1.5
      max_interval: 1s
    jitter: 0.2
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|:---|:---|:---|
| `enabled` | –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å async —Ä–µ–∂–∏–º | `true` |
| `timeout` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è | `10s`, `30s` |
| `interval` | –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ | `200ms`, `500ms` |
| `backoff.enabled` | –í–∫–ª—é—á–∏—Ç—å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ | `true` |
| `backoff.factor` | –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–∏ (1.5 = +50%) | `1.5`, `2.0` |
| `backoff.max_interval` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (–æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å —Ä–æ—Å—Ç–∞) | `1s`, `2s` |
| `jitter` | –°–ª—É—á–∞–π–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (0.2 = ¬±20% –æ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞) | `0.2` |

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Backoff

–ë–µ–∑ backoff (fixed interval):
```
–ü–æ–ø—ã—Ç–∫–∞ 1, –∂–¥—ë–º 200ms, –ü–æ–ø—ã—Ç–∫–∞ 2, –∂–¥—ë–º 200ms, –ü–æ–ø—ã—Ç–∫–∞ 3...
```

–° backoff (factor = 1.5):
```
–ü–æ–ø—ã—Ç–∫–∞ 1, –∂–¥—ë–º 200ms, –ü–æ–ø—ã—Ç–∫–∞ 2, –∂–¥—ë–º 300ms, –ü–æ–ø—ã—Ç–∫–∞ 3, –∂–¥—ë–º 450ms... max 1s
```

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Jitter

Jitter –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å "—ç—Ñ—Ñ–µ–∫—Ç–∞ —Å—Ç–∞–¥–∞" (thundering herd):
- –ë–µ–∑ jitter: 100 —Ç–µ—Å—Ç–æ–≤ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –ë–î –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∫–∞–∂–¥—ã–µ 200ms, –ø–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
- –° jitter 0.2: –∑–∞–ø—Ä–æ—Å—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –æ—Ç 160ms –¥–æ 240ms, –ø–ª–∞–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### HTTP DSL: –û–∂–∏–¥–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `202 Accepted` –∏ —Å—Ç–∞—Ç—É—Å `PENDING`. –ù—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è —Å—Ç–∞—Ç—É—Å–∞ `COMPLETED`:

```go
s.AsyncStep(t, "Wait for order completion", func(sCtx provider.StepCtx) {
    orders.GetOrder(sCtx, orderID).
        ExpectResponseStatus(200).
        ExpectResponseBodyFieldValue("status", "COMPLETED"). // Retry –ø–æ–∫–∞ –Ω–µ —Å—Ç–∞–Ω–µ—Ç COMPLETED
        ExpectResponseBodyFieldNotEmpty("completedAt").
        Send()
})
```

### Database DSL: –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏

–ü–æ—Å–ª–µ HTTP –∑–∞–ø—Ä–æ—Å–∞ –∑–∞–ø–∏—Å—å –≤ –ë–î –º–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—å—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (—Ç—Ä–∏–≥–≥–µ—Ä—ã, –æ—á–µ—Ä–µ–¥–∏):

```go
// –°–æ–∑–¥–∞–ª–∏ –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ API
orderID := createOrderViaAPI()

// –ñ–¥—ë–º, –ø–æ–∫–∞ –∑–∞–ø–∏—Å—å –ø–æ—è–≤–∏—Ç—Å—è –≤ –ë–î
s.AsyncStep(t, "Wait for order in DB", func(sCtx provider.StepCtx) {
    orders.FindByID(sCtx, orderID).
        ExpectFound().                              // Retry –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥—ë—Ç—Å—è
        ExpectColumnEquals("status", "pending").
        Send()
})
```

### Kafka DSL: –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

–°–æ–±—ã—Ç–∏–µ –≤ Kafka –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ API-–∑–∞–ø—Ä–æ—Å–∞:

```go
// –°–æ–∑–¥–∞–ª–∏ –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ API
playerID := createPlayerViaAPI()

// –ñ–¥—ë–º —Å–æ–±—ã—Ç–∏–µ –≤ Kafka
s.AsyncStep(t, "Wait for PLAYER_CREATED event", func(sCtx provider.StepCtx) {
    kafkaDSL.Expect[kafka.PlayerEventsTopic](sCtx, kafka.Client()).
        With("playerId", playerID).
        With("eventType", "PLAYER_CREATED").
        ExpectField("playerName", "test_user").
        Send()
})
```

### –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ sync –∏ async —à–∞–≥–æ–≤

–í –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ –º–æ–∂–Ω–æ —Å–º–µ—à–∏–≤–∞—Ç—å –æ–±–∞ —Ç–∏–ø–∞:

```go
func (s *OrderSuite) TestCreateOrder(t provider.T) {
    var orderID string

    // –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —à–∞–≥: HTTP –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 201 –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
    s.Step(t, "Create order via API", func(sCtx provider.StepCtx) {
        resp := orders.CreateOrder(sCtx).
            RequestBody(models.OrderRequest{...}).
            ExpectResponseStatus(201).  // –ü–∞–¥–∞–µ–º —Å—Ä–∞–∑—É, –µ—Å–ª–∏ –Ω–µ 201
            Send()
        orderID = resp.Body.ID
    })

    // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —à–∞–≥: –∂–¥—ë–º –ø–æ—è–≤–ª–µ–Ω–∏—è –≤ –ë–î
    s.AsyncStep(t, "Wait for order in DB", func(sCtx provider.StepCtx) {
        orders.FindByID(sCtx, orderID).
            ExpectFound().  // Retry
            Send()
    })

    // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —à–∞–≥: –∂–¥—ë–º —Å–æ–±—ã—Ç–∏–µ –≤ Kafka
    s.AsyncStep(t, "Wait for ORDER_CREATED event", func(sCtx provider.StepCtx) {
        kafkaDSL.Expect[kafka.OrdersTopic](sCtx, kafka.Client()).
            With("orderId", orderID).
            Send()
    })
}
```

## Polling Summary –≤ Allure

–ö–∞–∂–¥—ã–π `AsyncStep` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç **Polling Summary** –∫ –æ—Ç—á—ë—Ç—É Allure:

```json
{
  "attempts": 5,
  "elapsed_time": "1.234s",
  "success": true
}
```

–ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –ø—Ä–æ—à–ª–∏:

```json
{
  "attempts": 15,
  "elapsed_time": "10.001s",
  "success": false,
  "failed_checks": [
    "Expected status 'COMPLETED', got 'PENDING'",
    "Field 'completedAt' is empty"
  ],
  "timeout_reason": "Timeout or context cancelled",
  "last_error": "context deadline exceeded"
}
```

–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –ø–æ—á–µ–º—É —Ç–µ—Å—Ç —É–ø–∞–ª:
- –ë—ã–ª–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏?
- –î–∞–Ω–Ω—ã–µ –≤–æ–æ–±—â–µ –Ω–µ –ø—Ä–∏—à–ª–∏?
- –ü—Ä–∏—à–ª–∏, –Ω–æ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏?

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AsyncStep

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ AsyncStep:**
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ HTTP/DB/Kafka –∑–∞–ø—Ä–æ—Å—ã)
- –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ Kafka
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—è–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –≤ –ë–î –ø–æ—Å–ª–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –û–∂–∏–¥–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ API (PENDING, COMPLETED)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (—Ç—Ä–∏–≥–≥–µ—Ä—ã, –æ—á–µ—Ä–µ–¥–∏, —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏)

**–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ AsyncStep:**
- –ó–∞–≤–∏—Å–∏–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–≤–æ–≥–æ –Ω—É–∂–µ–Ω –≤—Ç–æ—Ä–æ–º—É, –±—É–¥–µ—Ç race condition)
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É —Å—Ä–∞–∑—É (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Step` —Å `Require`)
- Negative-—Ç–µ—Å—Ç—ã (–ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∑–∞–ø–∏—Å—å –ù–ï –ø–æ—è–≤–∏–ª–∞—Å—å)

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏

#### –•–æ—Ä–æ—à–æ: –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
```go
// –≠—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã ‚Äî –∑–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
s.AsyncStep(t, "Fetch user", func(sCtx provider.StepCtx) {
    users.GetUser(sCtx, "123").Send()
})
s.AsyncStep(t, "Fetch product", func(sCtx provider.StepCtx) {
    products.GetProduct(sCtx, "456").Send()
})
s.AsyncStep(t, "Fetch settings", func(sCtx provider.StepCtx) {
    settings.GetSettings(sCtx).Send()
})

// Sync —à–∞–≥ –¥–æ–∂–¥—ë—Ç—Å—è –≤—Å–µ—Ö —Ç—Ä—ë—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
s.Step(t, "Verify all data loaded", func(sCtx provider.StepCtx) {
    // –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
})
```

#### –ü–ª–æ—Ö–æ: –ó–∞–≤–∏—Å–∏–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å AsyncStep
```go
// –ù–ï –î–ï–õ–ê–ô–¢–ï –¢–ê–ö! –ë—É–¥–µ—Ç race condition
var userID string

s.AsyncStep(t, "Create user", func(sCtx provider.StepCtx) {
    resp := users.CreateUser(sCtx).Send()
    userID = resp.Body.ID
})

//  –û–®–ò–ë–ö–ê: userID –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ –≥–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö
s.AsyncStep(t, "Update user", func(sCtx provider.StepCtx) {
    users.UpdateUser(sCtx, userID).Send() // Race condition!
})
```

#### –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ó–∞–≤–∏—Å–∏–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å Step
```go
var userID string

// –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —à–∞–≥: –¥–æ–∂–¥—ë–º—Å—è —Å–æ–∑–¥–∞–Ω–∏—è
s.Step(t, "Create user", func(sCtx provider.StepCtx) {
    resp := users.CreateUser(sCtx).Send()
    userID = resp.Body.ID
})

// –¢–µ–ø–µ—Ä—å –±–µ–∑–æ–ø–∞—Å–Ω–æ: userID –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω
s.Step(t, "Update user", func(sCtx provider.StepCtx) {
    users.UpdateUser(sCtx, userID).Send()
})
```

#### –•–æ—Ä–æ—à–æ: –ë–∞—Ç—á–∏ async + sync checkpoints
```go
// Batch 1: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
s.AsyncStep(t, "Setup DB", ...)
s.AsyncStep(t, "Setup Kafka", ...)
s.AsyncStep(t, "Setup Cache", ...)

// Checkpoint: –¥–æ–∂–¥—ë–º—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
s.Step(t, "Verify setup complete", ...)

// Batch 2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ä–∞–∑–Ω—ã—Ö —Ñ–∏—á
s.AsyncStep(t, "Test feature A", ...)
s.AsyncStep(t, "Test feature B", ...)
s.AsyncStep(t, "Test feature C", ...)

// Final checkpoint
s.Step(t, "Verify all tests passed", ...)
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ timeout

- **HTTP DSL:** 10-15 —Å–µ–∫—É–Ω–¥ (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ API –æ—Ç–≤–µ—á–∞—é—Ç –±—ã—Å—Ç—Ä–æ)
- **Database DSL:** 10-15 —Å–µ–∫—É–Ω–¥ (—Ç—Ä–∏–≥–≥–µ—Ä—ã –æ–±—ã—á–Ω–æ –±—ã—Å—Ç—Ä—ã–µ)
- **Kafka DSL:** 30-60 —Å–µ–∫—É–Ω–¥ (–±—Ä–æ–∫–µ—Ä –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –¥–æ—Å—Ç–∞–≤–∫–∏)

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤

1. **–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –º–∞–ª–æ–≥–æ `interval`:** 100-200ms –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤
2. **–í–∫–ª—é—á–∞–π—Ç–µ backoff:** —ç–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–º –æ–∂–∏–¥–∞–Ω–∏–∏
3. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ max_interval:** –Ω–µ –±–æ–ª—å—à–µ 1-2 —Å–µ–∫—É–Ω–¥
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ jitter:** —Å–Ω–∏–∂–∞–µ—Ç –ø–∏–∫–æ–≤—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É

# –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–¢–µ—Å—Ç—ã —á–∞—Å—Ç–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π: —Ç–æ–∫–µ–Ω–∞–º–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –ø–∞—Ä–æ–ª—è–º–∏, API –∫–ª—é—á–∞–º–∏. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Allure –æ—Ç—á—ë—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã —à–∏—Ä–æ–∫–æ–º—É –∫—Ä—É–≥—É –ª–∏—Ü. –§—Ä–µ–π–º–≤–æ—Ä–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–π –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏** —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ HTTP –∑–∞–ø—Ä–æ—Å–∞—Ö, SQL –∑–∞–ø—Ä–æ—Å–∞—Ö –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –∏–∑ –ë–î.

---

## –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –£—Ç–µ—á–∫–∞ credentials –≤ –æ—Ç—á—ë—Ç–∞—Ö

–ë–µ–∑ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ Allure –æ—Ç—á—ë—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```
HTTP Request
Headers:
  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...  
  Cookie: session_id=abc123def456...                          

SQL Query:
  UPDATE users SET password = ? WHERE id = ?
Arguments:
  [1] MySecretPassword123  
  [2] 42
```

–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

### –†–µ—à–µ–Ω–∏–µ: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞

–° –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –º–∞—Å–∫–∏—Ä–æ–≤–∫–æ–π –æ—Ç—á—ë—Ç –±–µ–∑–æ–ø–∞—Å–µ–Ω:

```
HTTP Request
Headers:
  Authorization: Bearer ***MASKED***  
  Cookie: ***MASKED***                

SQL Query:
  UPDATE users SET password = ? WHERE id = ?
Arguments:
  [1] ***MASKED***  
  [2] 42
```

---

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∏—á–µ–≥–æ –Ω–µ –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è.** –í—ã –¥–æ–ª–∂–Ω—ã —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –∫–∞–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –∫–æ–ª–æ–Ω–∫–∏ –Ω—É–∂–Ω–æ —Å–∫—Ä—ã—Ç—å.

**–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Ç–æ—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é –∏–º—ë–Ω:**
- HTTP –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization` –±—É–¥–µ—Ç –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ —É–∫–∞–∑–∞–Ω–æ –∏–º–µ–Ω–Ω–æ `Authorization`
- –ö–æ–ª–æ–Ω–∫–∞ –ë–î `user_password` –±—É–¥–µ—Ç –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ —É–∫–∞–∑–∞–Ω–æ `user_password`
- –ß–∞—Å—Ç–∏—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ù–ï —Ä–∞–±–æ—Ç–∞—é—Ç: –∫–æ–Ω—Ñ–∏–≥ `password` –Ω–µ –∑–∞–º–∞—Å–∫–∏—Ä—É–µ—Ç –∫–æ–ª–æ–Ω–∫—É `user_password_hash`

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏

### HTTP: –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

–£–∫–∞–∂–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å:

```yaml
http:
  gameService:
    baseURL: "https://game-api.example.com"
    timeout: 30s
    maskHeaders: "Authorization,Cookie,X-API-Key"  # –ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –°–ø–∏—Å–æ–∫ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è –∑–∞–ø—è—Ç—ã–º–∏
- –†–µ–≥–∏—Å—Ç—Ä –Ω–µ –≤–∞–∂–µ–Ω (case-insensitive): `Authorization` = `authorization`
- –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ **—Ç–æ—á–Ω–æ–µ**: `Authorization` –Ω–µ –∑–∞–º–∞—Å–∫–∏—Ä—É–µ—Ç `X-Authorization`
- –î–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Authorization` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–µ—Ñ–∏–∫—Å (Bearer/Basic), –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ `***MASKED***`

### Database: –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –∫–æ–ª–æ–Ω–æ–∫

–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–æ–Ω–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å –≤ SQL —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö:

```yaml
database:
  coreDatabase:
    driver: "postgres"
    dsn: "postgres://user:password@localhost:5432/game_db?sslmode=disable"
    maxOpenConns: 10
    maxIdleConns: 5
    maskColumns: "password,api_token,secret_key"  # –ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –°–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è –∑–∞–ø—è—Ç—ã–º–∏
- –†–µ–≥–∏—Å—Ç—Ä –Ω–µ –≤–∞–∂–µ–Ω (case-insensitive): `password` = `PASSWORD`
- –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ **—Ç–æ—á–Ω–æ–µ**: `password` –Ω–µ –∑–∞–º–∞—Å–∫–∏—Ä—É–µ—Ç `user_password` –∏–ª–∏ `password_hash`
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å `user_password`, —É–∫–∞–∂–∏—Ç–µ –µ–≥–æ —è–≤–Ω–æ: `maskColumns: "password,user_password"`

---

## –ü—Ä–∏–º–µ—Ä—ã –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏

### HTTP: –ó–∞–≥–æ–ª–æ–≤–∫–∏

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
http:
  authService:
    baseURL: "https://auth.example.com"
    maskHeaders: "Authorization,X-Admin-Secret"
```

**Allure –æ—Ç—á—ë—Ç (HTTP Request):**
```
Headers:
  Content-Type: application/json
  Authorization: Bearer ***MASKED***       # –ò–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (—Å–æ—Ö—Ä–∞–Ω—ë–Ω –ø—Ä–µ—Ñ–∏–∫—Å Bearer)
  X-Admin-Secret: ***MASKED***             # –ò–∑ –∫–æ–Ω—Ñ–∏–≥–∞
  X-Request-ID: abc-123-def-456            # –ù–µ –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è
```

### Database: –ö–æ–ª–æ–Ω–∫–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

**–ö–æ–Ω—Ñ–∏–≥:**
```yaml
database:
  coreDatabase:
    driver: "mysql"
    dsn: "user:pass@tcp(localhost:3306)/db"
    maskColumns: "password,api_token"  # –¢–æ—á–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫
```

**SQL –∑–∞–ø—Ä–æ—Å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```sql
SELECT id, username, password, email, api_token FROM users WHERE id = 1
```

**Allure –æ—Ç—á—ë—Ç (SQL Result):**
```json
{
  "id": 1,
  "username": "john_doe",
  "password": "***MASKED***",         // –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–æ (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∫–æ–Ω—Ñ–∏–≥–æ–º)
  "email": "john@example.com",        // –ù–µ –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è
  "api_token": "***MASKED***"         // –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–æ (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∫–æ–Ω—Ñ–∏–≥–æ–º)
}
```

**–ß—Ç–æ –ù–ï –±—É–¥–µ—Ç –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∏ `maskColumns: "password"`:**
- –ö–æ–ª–æ–Ω–∫–∞ `user_password` (–¥—Ä—É–≥–æ–µ –∏–º—è)
- –ö–æ–ª–æ–Ω–∫–∞ `password_hash` (–¥—Ä—É–≥–æ–µ –∏–º—è)
- –ö–æ–ª–æ–Ω–∫–∞ `reset_password_token` (–¥—Ä—É–≥–æ–µ –∏–º—è)

–î–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ —ç—Ç–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∏—Ö —è–≤–Ω–æ:
```yaml
maskColumns: "password,user_password,password_hash,reset_password_token"
```

---

## –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```yaml
# HTTP –∫–ª–∏–µ–Ω—Ç—ã
http:
  gameService:
    baseURL: "https://game-api.example.com"
    timeout: 30s
    maskHeaders: "Authorization,Cookie,X-API-Key"  # –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
database:
  coreDatabase:
    driver: "postgres"
    dsn: "postgres://user:password@localhost:5432/game_db?sslmode=disable"
    maxOpenConns: 10
    maxIdleConns: 5
    maskColumns: "password,user_password,api_token,secret_key,private_key"  # –¢–æ—á–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫

# Kafka (–º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è - —Å–æ–±—ã—Ç–∏—è –ø—É–±–ª–∏—á–Ω—ã)
kafka:
  bootstrapServers:
    - "kafka.example.com:9092"
  groupId: "qa-test-group"
  topics:
    - "game-player-events"
  bufferSize: 1000
```

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### Ô∏è –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –≤ –æ—Ç—á—ë—Ç–∞—Ö

–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –∫ –¥–∞–Ω–Ω—ã–º –≤ Allure –æ—Ç—á—ë—Ç–∞—Ö**. –†–µ–∞–ª—å–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –∏ SQL –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.

```go
// –í —Ç–µ—Å—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
httpClient.Do(req.Header("Authorization", "Bearer real-token-12345"))

// –í Allure –æ—Ç—á—ë—Ç–µ –±—É–¥–µ—Ç: Authorization: Bearer ***MASKED***
// –ù–æ —Ä–µ–∞–ª—å–Ω—ã–π HTTP –∑–∞–ø—Ä–æ—Å —É–π–¥—ë—Ç —Å: Authorization: Bearer real-token-12345
```

### –ß—Ç–æ –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è

- HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ (request –∏ response)
- SQL –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤ –æ—Ç—á—ë—Ç–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ó–Ω–∞—á–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –≤ SQL —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

### –ß—Ç–æ –ù–ï –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è

- –¢–µ–ª–∞ JSON –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ (–µ—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç sensitive –ø–æ–ª—è, –∏—Ö –Ω—É–∂–Ω–æ –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å)
- Kafka —Å–æ–æ–±—â–µ–Ω–∏—è (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç credentials)
- –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–º–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –£–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–æ—á–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫

–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ —Ç–æ—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é:

```yaml
#  –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: password –Ω–µ –∑–∞–º–∞—Å–∫–∏—Ä—É–µ—Ç user_password –∏–ª–∏ password_hash
database:
  coreDatabase:
    maskColumns: "password"

#  –ü—Ä–∞–≤–∏–ª—å–Ω–æ: —É–∫–∞–∂–∏—Ç–µ –≤—Å–µ –Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏
database:
  coreDatabase:
    maskColumns: "password,user_password,password_hash,reset_password_token"
```

### –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ maskColumns –¥–ª—è production-like –ë–î

–ï—Å–ª–∏ —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```yaml
database:
  productionDB:
    maskColumns: "password,user_password,secret,api_token,access_token,refresh_token,ssn,credit_card_number"
```

### –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ credentials –≤ –∫–æ–¥–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```yaml
http:
  apiService:
    baseURL: "https://api.example.com"
    defaultHeaders:
      Authorization: "Bearer ${API_TOKEN}"  # –ß–∏—Ç–∞–µ—Ç—Å—è –∏–∑ env –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
```

### –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ—Ç—á—ë—Ç—ã –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π

–î–∞–∂–µ —Å –º–∞—Å–∫–∏—Ä–æ–≤–∫–æ–π:
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ –≤ –æ—Ç—á—ë—Ç–∞—Ö –Ω–µ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö credentials
- –ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ –æ—Ç—á—ë—Ç—ã –≤ –æ—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ Allure —Å–µ—Ä–≤–µ—Ä—É

---